@model _24DH11420_LTTH_BE234.Models.ViewModel.Cart

@{
    ViewBag.Title = "Giỏ hàng";
    Layout = "~/Views/Shared/_CustomerLayout.cshtml";
}

<style>
    .cart-section {
        background-color: white;
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
    }

    .cart-summary {
        background-color: white;
        border-radius: 10px;
        padding: 20px;
    }

    .quantity-input {
        width: 60px;
        text-align: right;
    }

    .action-icon {
        max-height: 20px;
        cursor: pointer;
    }

    .category-header {
        font-size: 1.5rem;
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }
</style>

<h2>GIỎ HÀNG</h2>

<div class="row">
    @if (Model.Items.Any())
    {
        <div class="col-md-8">
            @foreach (var categoryGroup in Model.GroupedItems)
            {
                <div class="cart-section">
                    <h3 class="category-header">@categoryGroup.Key</h3>
                    <table class="table align-middle">
                        <thead>
                            <tr>
                                <th colspan="2">Sản phẩm</th>
                                <th>Số lượng</th>
                                <th>Đơn giá</th>
                                <th>Thành tiền</th>
                                <th>
                                   
                                    <a href="@Url.Action("ClearCart", "Cart")" title="Xóa tất cả mặt hàng trong giỏ"
                                       class="float-end">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var item in categoryGroup)
                            {
                                <tr>
                                    <td>
                                        <img src="@Url.Content(item.ProductImage)" alt="@item.ProductName" style="max-height:80px;" />
                                    </td>
                                    <td>@item.ProductName</td>
                                    <td>
                                        @using (Html.BeginForm("UpdateQuantity", "Cart", FormMethod.Post, new { @class = "d-flex" }))
                                        {
                                            @Html.Hidden("id", item.ProductID)
                                            <input type="number" name="quantity" class="form-control quantity-input" value="@item.Quantity" min="1" max="100" />
                                            <input type="submit" value="Cập nhật" class="btn btn-sm btn-link p-0 ms-1" />
                                        }
                                    </td>
                                    <td>@string.Format("{0:N0}", item.UnitPrice) ₫</td>
                                    <td>@string.Format("{0:N0}", item.TotalPrice) ₫</td>
                                    <td>
                                        <a href="@Url.Action("RemoveFromCart", "Cart", new { id = item.ProductID })">
                                            <i class="fas fa-trash"></i>
                                        </a>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
        </div>

        <div class="col-md-4">
            <div class="cart-summary">
                <h4>Tổng cộng</h4>
                <hr />
                <div class="d-flex justify-content-between">
                    <h5>Tổng giá trị:</h5>
                    <h5 style="color: red; font-weight: bold;">
                        @string.Format("{0:N0}", Model.TotalValue()) ₫
                    </h5>
                </div>
                <br />
                @Html.ActionLink("Mua hàng", "Checkout", "Order", null, new { @class = "btn btn-danger w-100" })
            </div>
            <div class="mt-3">
                @Html.ActionLink("Tiếp tục mua hàng", "Index", "Home", null, new { @class = "btn btn-warning w-100" })
            </div>
        </div>
    }
    else
    {
        <p>Bạn chưa có sản phẩm nào trong giỏ.</p>
        @Html.ActionLink("Tiếp tục mua hàng", "Index", "Home", null, new { @class = "btn btn-warning" })
    }
</div>