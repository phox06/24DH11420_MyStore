@using _24DH11420_LTTH_BE234.Models.ViewModel
@{
    ViewBag.Title = "Dashboard";
    Layout = "~/Areas/Admin/Views/Shared/Admin_Layout.cshtml";
    var statistics = ViewBag.Statistics as List<CategoryStatisticVM>;
}


<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">

    // 1. Tải thư viện
    google.charts.load('current', { 'packages': ['corechart'] });

    // 2. Đặt callback function khi thư viện đã sẵn sàng
    google.charts.setOnLoadCallback(drawChart);

    // 3. Hàm vẽ biểu đồ
    function drawChart() {

        // 4. Tạo bảng dữ liệu (Data Table) từ dữ liệu ViewBag
        var data = new google.visualization.DataTable();
        data.addColumn('string', 'Category');
        data.addColumn('number', 'ProductCount');

        // Lấy dữ liệu JSON từ ViewBag
        var chartData = @ViewBag.ChartData;

        // Thêm dữ liệu vào bảng
        for (var i = 0; i < chartData.length; i++) {
            data.addRow([chartData[i].CategoryName, chartData[i].ProductCount]);
        }

        // 5. Cấu hình các tùy chọn cho biểu đồ
        var options = {
            title: 'Tỷ lệ hàng hóa',
            is3D: true,
            pieHole: 0.4,
        };

        // 6. Khởi tạo và vẽ biểu đồ
        var chart = new google.visualization.PieChart(document.getElementById('piechart_3d'));
        chart.draw(data, options);
    }
</script>


<h3 class="bg-success text-white p-2">THỐNG KÊ HÀNG HÓA TỪNG LOẠI</h3>
<table class="table table-bordered table-striped">
    <thead class="bg-success-light">
        <tr>
            <th>LOẠI HÀNG</th>
            <th>SỐ LƯỢNG</th>
            <th>GIÁ CAO NHẤT</th>
            <th>GIÁ THẤP NHẤT</th>
            <th>GIÁ TRUNG BÌNH</th>
        </tr>
    </thead>
    <tbody>
        @if (statistics != null)
        {
            foreach (var item in statistics)
            {
                <tr>
                    <td>@item.CategoryName</td>
                    <td>@item.ProductCount</td>
                    <td>@string.Format("{0:N0}", item.MaxPrice) ₫</td>
                    <td>@string.Format("{0:N0}", item.MinPrice) ₫</td>
                    <td>@string.Format("{0:N0}", item.AvgPrice) ₫</td>
                </tr>
            }
        }
    </tbody>
</table>

<h3 class="bg-success text-white p-2 mt-4">BIỂU ĐỒ THỐNG KÊ</h3>
<div id="piechart_3d" style="width: 100%; height: 500px;"></div>
